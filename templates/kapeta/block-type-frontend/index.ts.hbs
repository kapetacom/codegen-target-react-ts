//#FILENAME:src/server/index.ts:create-only
import Path from 'path';
import FS from 'fs';
import {Server} from "@kapeta/sdk-server";
const server = new Server('{{data.metadata.name}}', Path.resolve(__dirname, '../..'));
import express from 'express';
import history from 'connect-history-api-fallback';
{{#consumers-of-type 'kapeta/resource-type-rest-client'}}
import { {{type metadata.name}}ProxyRoute } from './proxies/rest/{{type metadata.name}}ProxyRoute';
{{/consumers-of-type}}
{{#consumers-of-type 'kapeta/resource-type-web-fragment'}}
import { {{type metadata.name}}ProxyRoute } from './proxies/fragments/{{type metadata.name}}ProxyRoute';
{{/consumers-of-type}}

const devMode = process.env.NODE_ENV &&
                process.env.NODE_ENV.toLowerCase() === 'development';

{{#consumers-of-type 'kapeta/resource-type-web-fragment'}}
server.addRoute(
    new {{type metadata.name}}ProxyRoute()
);
{{/consumers-of-type}}
{{#consumers-of-type 'kapeta/resource-type-rest-client'}}
server.addRoute(
    new {{type metadata.name}}ProxyRoute()
);
{{/consumers-of-type}}

const BASE_DIR = Path.resolve(__dirname, "../../dist");
const webpackConfig = require("../../webpack.development.config");
server.configureAssets(BASE_DIR, webpackConfig);

server.start('web');